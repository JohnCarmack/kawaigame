<!DOCTYPE html>
<html>
    <head>
        <title>Kawai Game</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./css/index.css" />
		  <!-- Bootstrap -->
		<link rel="stylesheet" type="text/css" href="bootstrap-3.3.6-dist/css/bootstrap.css"/>


		<script type="text/javascript" src="js/jquery-1.11.3.js"></script>  
		<script type="text/javascript" src="bootstrap-3.3.6-dist/js/bootstrap.js"></script>
		<script type="text/javascript" src="js/SpritesSheet.js"></script>
        <script type="text/javascript" src="js/Objets.js"></script>
        <script type="text/javascript" src="js/Loading.js"></script>
        <script type="text/javascript" src="js/Map.js"></script>
        <script type="text/javascript" src="js/Utils.js"></script>
        <script type="text/javascript" src="js/Projectiles.js"></script>
        <script type="text/javascript" src="js/Joueur.js"></script>
		<script type="text/javascript" src="js/bdd.js"></script>
        <script type="text/javascript" src="js/App.js"></script>
        <script type="text/javascript" src="js/main.js"></script>
        <script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
    </head>
		
        <script>  
			var username;
            var conversation, data, datasend, users;
            var form, connexion, inscription;
          
            var socket = io.connect();  
            // on connection to server, ask for user's name with an anonymous callback
            //while (typeof username=="undefined"){
            socket.on('connect', function(){  
                    // call the server-side function 'adduser' and send one parameter (value of prompt) 
                   // var username = document.getElementById("nomPseudo").value;
                    //socket.emit('adduser', username);  
            });  
            //}
          
            // listener, whenever the server emits 'updatechat', this updates the chat body   
            socket.on('updatechat', function (username, data) {  
                var chatMessage = "<b>" + username + ":</b> " + data + "<br>";  
                conversation.innerHTML += chatMessage;   
            });  
          
          
            // listener, whenever the server emits 'updateusers', this updates the username list  
            socket.on('updateusers', function(listOfUsers) {  
                users.innerHTML = "";  
                for(var name in listOfUsers) {  
                    var userLineOfHTML = '<div>' + name + '</div>';  
                    users.innerHTML += userLineOfHTML;  
                }  
            });  
          
            //update players positions 
              // just one player moved
            socket.on('updatepos', function (username, newPos, dir) {
              console.log(dir);
              updatePlayerNewPos(username, newPos, dir);
            });
            //when the game is starting
            socket.on('startGame', function (lvl, listOfPlayers) {
              startGame(lvl, listOfPlayers);
            });
            // update players (isLvLDone? isDead?)
            socket.on('updatePlayers', function (listOfPlayer) {
              updatePlayers(listOfPlayer);
            });
            //updateGame
            socket.on('updategame', function (lvl, deads, isLost, menu,starting) {
              updateGame(lvl, deads, isLost, menu,starting);
            });
            //on commence le jeu
            socket.on('sendStart', function (lvl) {
              startGame(pos, lvl);
            });
          
            // on load of page  
            window.addEventListener("load", function(){  
                // get handles on various GUI components  
                conversation = document.querySelector("#conversation"); 
                //console.log(document.getElementById('nomPseudo'));
                form = document.querySelector("#formInsc");
                connexion = document.querySelector("#connexion");
                inscription =  document.querySelector("#inscription");
               
                data = document.querySelector("#data");  
                datasend = document.querySelector("#datasend");  
                users = document.querySelector("#users");  
                
                connexion.addEventListener("click", function(evt) {  
                        // à remplir par la suite, pour avoir le comportement souhaité  
                });
                inscription.addEventListener("click", function(evt) { 
						Inscription();
                        username = document.getElementById("nomPseudo").value;
                        console.log("clique sur le bouton d'inscription on crée l'utilisateur "+username); 
                        socket.emit('adduser', username);
                });
                // Listener for send button  
                datasend.addEventListener("click", function(evt) {  
                    sendMessage();  
                });  
          
                // detect if enter key pressed in the input field  
                data.addEventListener("keypress", function(evt) {  
                        // if pressed ENTER, then send  
                        if(evt.keyCode == 13) {  
                    this.blur();  
                        sendMessage();  
                        }  
                });  
          
                // sends the chat message to the server  
                function sendMessage() {
                    console.log("sendind a message : "+data.value);  
                    var message = data.value;  
                    data.value = "";  
                    // tell server to execute 'sendchat' and send along one parameter  
                    socket.emit('sendchat', message);  
                }         
            });  
          //});
        </script>  
    <body>
	<div id="LienAccueil"><a href="#Accueil" data-toggle="modal" data-target="#Accueil">Modal</a></div>
	<div class="modal fade" id="Accueil" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		  <div class="modal-dialog" role="document">
			<div class="modal-content">
			  <div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="NomJeu">Kawaigame</h4>
			  </div>
			  <div class="modal-body">
				<form class="form-horizontal">
					<div class="form-group">
						<div id="divPseudo" class="form-group">
							<label class="col-sm-3 control-label" for="pseudo">Pseudo</label>
							<div class="col-sm-4">
								<input type="text" name="pseudo" id="nomPseudo" class="form-control" onfocus="SuppMessageError()"/>
							</div>
						</div>
					</div>
				</form>
				<div>
					<input id="inscription" type="submit" name="Inscription" value="Inscription" class="btn btn-primary"/>
					<input id="connexion" type="submit" name="Connexion" value="Connexion" class="btn btn-primary" href="#Serveurs" data-toggle="modal" data-target="#Serveurs" data-dismiss="modal" aria-label="Close"/>
				</div>
			  </div>
			</div>
		  </div>
		</div>
		<div class="modal fade" id="Serveurs" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		  <div class="modal-dialog" role="document">
			<div class="modal-content">
			  <div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="NomJeuS">Kawaigame</h4>
			  </div>
			  <div class="modal-body">
				<form class="form-horizontal">
					<div class="form-group">
						<div>
							<label class="col-sm-3 control-label" for="serveur">Serveur : </label>
							<div class="col-sm-5">
								<select name="serveur" id="serveur" class="form-control">
									<option>Room 1</option>
									<option>Room 2</option>
									<option>Room 3</option>
								</select>
							</div>
						</div>
					</div>
					<input type="submit" name="Sauvegarde" value="Sauvegarder" class="btn btn-primary" />
				</form>
				<div>
				</div>
			  </div>
			</div>
		  </div>
		</div>
		<h1>Kawaigame</h1>
        <div class="canvas"><canvas id="canvas" width="800" height="640"></canvas></div>
        <div id="P_serveurs">  
            <b>Serveurs:</b>   
        </div> 
		<div id="P_users">  
            <b>Joueurs:</b>  
            <div id="users"></div>  
        </div>  
        <div id="P_conversation">  
			<b>Tchat:</b> 
            <div id="conversation"></div>  
            <input id="data" placeholder="Ecrivez ici..."/>  
            <input type="button" id="datasend" value="send" />  
        </div>
    </body>
</html>
